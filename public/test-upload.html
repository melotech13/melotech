<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Upload Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <h2>Photo Upload Test</h2>
                
                <div class="card">
                    <div class="card-body">
                        <div class="upload-area border border-2 border-dashed border-primary rounded p-4 text-center" id="upload-area">
                            <input type="file" class="form-control d-none" id="photo" name="photo" accept="image/jpeg,image/png,image/jpg">
                            <div id="upload-placeholder">
                                <i class="fas fa-cloud-upload-alt fa-4x text-primary mb-3"></i>
                                <h5 class="text-primary">Drag & Drop your photo here</h5>
                                <p class="text-muted">or <span class="text-primary" style="cursor: pointer;" onclick="document.getElementById('photo').click()">click to browse</span></p>
                                <small class="text-muted">
                                    Supported formats: PNG, JPG, JPEG â€¢ Maximum size: 2MB
                                </small>
                            </div>
                            <div id="upload-preview" style="display: none;">
                                <img id="preview-image" src="" alt="Preview" class="img-fluid rounded mb-3" style="max-height: 300px;">
                                <p class="mb-2"><strong id="file-name"></strong></p>
                                <p class="small text-muted mb-2" id="file-size"></p>
                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeFile()">
                                    <i class="fas fa-times me-1"></i>Remove
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-primary" id="test-btn" disabled>Test Upload</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    console.log('Test page loaded');

    document.addEventListener('DOMContentLoaded', function() {
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('photo');
        const uploadPlaceholder = document.getElementById('upload-placeholder');
        const uploadPreview = document.getElementById('upload-preview');
        const previewImage = document.getElementById('preview-image');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');
        const testBtn = document.getElementById('test-btn');

        console.log('Elements found:', {
            uploadArea: !!uploadArea,
            fileInput: !!fileInput,
            uploadPlaceholder: !!uploadPlaceholder,
            uploadPreview: !!uploadPreview,
            previewImage: !!previewImage,
            fileName: !!fileName,
            fileSize: !!fileSize,
            testBtn: !!testBtn
        });

        function updateButton() {
            const hasFile = fileInput.files && fileInput.files.length > 0;
            testBtn.disabled = !hasFile;
        }

        // Handle file input change
        fileInput.addEventListener('change', function(e) {
            console.log('File input changed:', e.target.files.length, 'files');
            if (e.target.files && e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // Handle click to upload
        uploadArea.addEventListener('click', function(e) {
            if (!e.target.closest('.btn')) {
                console.log('Upload area clicked');
                fileInput.click();
            }
        });

        function handleFile(file) {
            console.log('Handling file:', file.name, file.type, file.size);
            
            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];
            if (!validTypes.includes(file.type)) {
                alert('Please select a valid image file (PNG, JPG, JPEG)');
                return;
            }

            // Validate file size (2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('File size must be less than 2MB');
                return;
            }

            // Preview the image
            const reader = new FileReader();
            reader.onload = function(e) {
                console.log('File read successfully, showing preview');
                
                previewImage.src = e.target.result;
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                
                uploadPlaceholder.style.display = 'none';
                uploadPreview.style.display = 'block';
                
                updateButton();
            };
            
            reader.onerror = function() {
                console.error('Error reading file');
                alert('Error reading file. Please try again.');
            };
            
            reader.readAsDataURL(file);
        }

        window.removeFile = function() {
            console.log('Removing file');
            fileInput.value = '';
            uploadPlaceholder.style.display = 'block';
            uploadPreview.style.display = 'none';
            updateButton();
        };

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        testBtn.addEventListener('click', function() {
            alert('File uploaded successfully! File: ' + (fileInput.files[0] ? fileInput.files[0].name : 'None'));
        });

        updateButton();
    });
    </script>
</body>
</html>
